# 向量搜索目前技术主流

## 1. Filter相关内容



## 2. 低成本高性能向量搜索



## 3. 新的方向





## 4. 我的简历内容

* 基于分布式存储的向量搜索
  * 对于蚂蚁内部低QPS、成本关键的业务场景，目前主流的Memory-Disk异构的向量搜索算法存在多副本容灾，故障恢复难等问题。我设计并实现基于PanguDFS的向量搜索算法，将向量搜索的主要存储成本卸载到PanguDFS，从而实现了成本的大幅节省。该算法可以同时兼容S3等对象存储，与Amazon S3 Vector和turbopuffer, 效果一致，提供低成本向量检索方案。
* 基于图压缩的向量检索
  * 目前PQ，SQ，RabitQ等量化压缩算法已经能够大幅度降低向量检索的成本, 另外目前很多Embedding Model也已经能够生成甚至1bit的向量。因此目前基于图或者倒排算法的主要成本在于邻接表的存储（1024d，64r是量化向量的2倍）。我设计并落地Elias-Fano 压缩算法，在召回性能保持不变的情况下将向量检索的成本在量化压缩方法下进一步压缩到原来的57%左右.
  * 结论：
    * 图内存压缩率71%
    * 磁盘算法场景内存压缩率最高57.71%
      * 内存量化向量 + 图，高精度fp32存硬盘
      * 压缩率 = 1 -（量化向量 + 压缩图）/ （量化向量 + 图）
        * pq，57%
        * sq4，38%
        * sq8，31%
        * rabitq，54%
      * QPS基本保持不变，recall不变
      * 简单的数据集压缩更大，例如SIFT，GIST压缩率最低，只有15%
* 下一代存算一体硬件向量搜索算法
  * 蚂蚁内部向量搜索架构低精度内存图遍历 + 重排, 重排的向量一般存储在SSD. 磁盘IO是该算法的主要瓶颈.阿里云内部提供存算一体新硬件（向量计算和存储都在SSD进行, 价格和普通SSD相当），设计两套算法适配不同的应用场景。
    * 针对图量化+重排场景：将重排部分算法集成到新硬件, QPS相比于内存 + SSD提高200%
    * 针对全向量存储在SSD场景：设计一套更加适合硬件pipeline的向量检索算法, QPS比纯内存场景提高100%
* 参与设计VSAG稀疏向量搜索
  * 目前主流的稀疏向量检索算法的瓶颈主要在于两个稀疏向量的距离计算, 我们提出新的算法用密集计算替换集合求交
  * 稀疏向量搜索做到目前10M大小以内数据集的SOTA，同时大幅降低向量存储需求
    * 1M数据集相同QPS, 是基于图的~60倍，构建事件是图的1/300，内存1/4
    * 5M数据集是~20倍，内存1/10
    * 10M数据集是~3倍，召回率90对99，内存占用极低, 内存1/5
  * 内部医保数据RAG，数据集10k~34k，内存1/10-1/5
* 参与VSAG内部向量搜索方案设计以及Benchmark调优
  * 参与HGraph讨论设计，以及性能调优
  * 在ANN-Benchmark上实现GIST赛道1st
  * 参与RabitQ, 4bit等量化算法落地





## 工具

* Vtune配置进行性能分析



## Elias-Fano

主要针对有序的数组进行压缩编码:

1. 计算得到数组的大小n, 以及最大值h
2. 计算低位的大小: low = log(n / h) , 最多需要的bit数m = log(h)上界, 那么高位up = m - low
3. 将数组的低位保存成值连串的值
4. 高位计算如下, 统计m - low bit二进制串的出现次数, 有多少次输出多少个1, 每个用0分割
5. 将高位保存成连续的串

在解码的时候:

* 比如我们要获取第i位
* 对于低位来说非常容易编码
* 对于高位来说找到第i个1即可, 那么它前面0的个数就是对应高位值

[Elias-Fano: 对排序整数进行准简洁压缩（2016） | by Wolf Garbe | Medium --- Elias-Fano: quasi-succinct compression of sorted integers in C# (2016) | by Wolf Garbe | Medium](https://wolfgarbe.medium.com/elias-fano-quasi-succinct-compression-of-sorted-integers-in-c-89f92a8c9986)

[Sorted integers compression with Elias-Fano encoding | Antonio Mallia](https://www.antoniomallia.it/sorted-integers-compression-with-elias-fano-encoding.html)



项目经历:

**1.基于分布式存储的低成本向量搜索方案**

* 针对公司内海量低频访问的业务场景，传统基于内存+磁盘的向量检索方案存在多副本容灾复杂以及故障恢复慢等痛点。(看一下Distributed的文章再说). **独立设计并实现**了一套将核心存储开销卸载至**盘古（PanguDFS）或对象存储**的向量检索架构，实现了计算与存储的解耦。该方案可无缝替代内存方案，功能与性能对标 Amazon S3 Vector 等业界前沿方案。该方案在保证业务可用性的前提下，利用分布式存储的自带高可用特性，简化了容灾机制，显著提升了故障恢复速度, 并且增强了系统可扩展性以及降低冗余成本。

**2. 基于无损图压缩的向量搜索算法优化**

* 在向量本身已被PQ/SQ等算法极限压缩后，基于图和基于倒排索引的邻接表成为存储瓶颈的主要瓶颈, 其开销甚至超过量化向量本身。 **创新性地引入并工程化落地无损 Elias-Fano 压缩算法**，对图索引邻接表进行深度压缩。通过精细调优，确保压缩后对上层检索的**QPS与召回率（Recall）基本无任何负向影响**。该方案在现有量化基础上，进一步将图索引内存开销降低了**57%**. 该方案以及落地蚂蚁支持了更大规模、更高维度的向量索引在有限资源下的部署**。

**3. 基于下一代存算一体硬件的向量搜索加速方案**

* 传统“CPU+SSD”架构的瓶颈在于磁盘I/O，限制了重排（Re-ranking）等关键步骤的性能，无法满足未来更高的QPS要求。**主导设计了两套算法**，以充分利用阿里云新型存算一体硬件（在SSD内集成向量计算单元）的特性。**方案一（针对重排场景）：** 将重排算法算子下推至硬件执行，消除CPU与SSD之间的数据传输瓶颈。**方案二（针对全量检索场景）：** 设计了更适配硬件流水线（Pipeline）的新型检索算法。该方案**实现QPS的跨越式提升**：重排场景下，QPS相较于“内存+SSD”方案**提升200%**；全量检索场景下，QPS相较于纯内存方案**提升100%**。

**4. 基于密集计算的VSAG稀疏向量搜索**

* 主流稀疏向量检索受限于海量集合求交运算，性能与扩展性存在瓶颈。**参与设计一种创新算法**，巧妙地用高效的**密集向量计算（Dense Computation）来替代稀疏向量的求交运算**. 该方案**达到业界稀疏向量搜索SOTA性能**, 在千万级以内（10M）数据集上，性能数倍于主流图检索方案，并在不同数据集规模下展现巨大优势, **1M 数据集**：QPS提升**60倍**，内存占用仅为**1/4**，构建速度快**300倍**, **10M 数据集**：QPS提升**3倍**，内存占用仅为**1/5, 应用于医保RAG场景，在数万级数据集上实现内存占用降低**80%-90%**




向量搜索项目经历
1. 基于分布式存储的低成本向量搜索方案

独立设计并实现了一套将核心存储开销卸载至盘古(PanguDFS)或S3兼容对象存储的向量检索架构，实现了计算与存储的解耦。该方案针对蚂蚁内部内海量低频访问场景，有效解决了传统方案成本高、容灾复杂及故障恢复慢的痛点。方案利用分布式存储的高可用性，显著简化了运维、提升了故障恢复速度与系统扩展性，性能与功能对标业界S3 Vector、turbopuffer等前沿方案。(CCF-A在投)

2. 基于无损列表压缩的向量搜索算法优化

为解决向量量化后图和倒排索引邻接表造成的内存瓶颈（在向量经过PQ/SQ量化后，主要存储成本在图和倒排列表），创新性地引入并工程化落地无损Elias-Fano压缩算法。通过精细调优，在不影响QPS与召回率的前提下，将图索引的内存开销在现有量化基础上进一步降低了57%。该技术已在蚂蚁内部署，有效支持了更大规模的向量索引在有限资源下的应用。

3. 基于下一代存算一体硬件的向量搜索加速方案

主导设计了针对阿里云新型存算一体硬件的向量检索加速算法，以突破传统架构的I/O瓶颈。通过将重排算子下推至硬件，以及设计适配硬件流水线的新型检索算法，实现了性能的跨越式提升。在重排场景下，QPS相较于“内存+SSD”方案提升3倍左右；在全量检索场景下，QPS相较于纯内存方案提升1倍左右。

4. 基于稠密计算的稀疏向量搜索

参与设计了一种用高效密集计算替代传统集合求交的创新稀疏向量检索算法，解决了主流方案的性能与扩展性瓶颈，达到了业界SOTA性能。在百万级数据集上，QPS提升60倍，内存占用仅为图算法的1/4，构建速度快300倍；在千万级数据集上，QPS提升3倍，内存占用仅为1/5。该方案已成功应用于内部医保RAG场景。

5. VSAG开源向量搜索库的设计

参与蚂蚁开源向量搜索框架VSAG建设，包括架构和接口设计，Benchmark打榜调优以及内部基于LSM架构的低成本向量检索系统。
